---
layout: post
title: CQRS
categories: [DDD]
tags: [DDD, CQRS]
comments: true
---
# 단일 모델의 단점
주문 내역 조회와 같은 조회 속도가 빠를수록 좋은 페이지를 구현할 시에 여러 애그리거트에서 데이터를 가져와야 할 경우 성능상의 이슈가 생길 수 있다.

예를들어, 아래처럼 주문 상세 조회 화면에 진입하면 "어떤 한 멤버가 주문한 상품의 상세 조회"를 조회하기 위해 세가지의 애그리거트에서 가져와야 하는 것이다.

[Order]<br/>
[Product]   ->   [주문 상세 조회 화면]<br/>
[Member]<br/>

ORM 을 이용하여 주로 Order.cancel() 이나 Order.changedShippingInfo() 도메인의 상태 변경을 구현하는 데는 적합하지만, 주문 상세 조회처럼 여러 애그리거트에서 데이터를 가져와 조회해야 하는 기능은 고려할 것들이 많다. 이 문제를 해결하기 위해서 *상태 변경 모델과 조회 모델*을 분리하는 것이 좋다. 이게 CQRS의 시작이다.

# CQRS
CQRS (Command and Query Responsibility Segregation) 는 말 그대로 명령과 쿼리 역할을 분리하는 것이다.

- 상태 변경: CREATE, UPDATE, DELETE
- 조회: SELECT

위의 단일모델을 예로 들면 상태 변경은 "주문 생성, 배송지 정보 변경, 회원 비밀번호 변경"을 들 수 있고 조회는 "주문 상세 조회, 회원 정보 조회, 게시물 목록 보기" 등이 해당될 수 있다.

상태 변경 로직 + 조회 분리

-> 상태 변경 로직과 조회 로직을 구현 기술을 다르게 설정할 수 있음.
-> 명령 모델: 객체 지향에 기반해서 도메인 모델을 구현하기에 적당한 JPA 사용
-> 조회 모델: SQL로 데이터 조회할 때 좋은 MyBatis 사용


# CQRS 장단점
복작한 모델은 로직을 분리 할 수 있어서 성능 향상 시킬 수 있음. (예, 조회 쿼리에 캐시를 붙이던가..)

단점:
- 간단한 도메인을 굳이 분리하면 코드만 늘어남.
